!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).insignia={})}(this,function(t){"use strict";var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},a=[],f=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,l=!1;function c(){l=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0;e<64;++e)a[e]=t[e],f[t.charCodeAt(e)]=e;f[45]=62,f[95]=63}function p(t,e,r){for(var n,i=[],o=e;o<r;o+=3)i.push(a[(n=(t[o]<<16)+(t[o+1]<<8)+t[o+2])>>18&63]+a[n>>12&63]+a[n>>6&63]+a[63&n]);return i.join("")}function u(t){var e;l||c();for(var r=t.length,n=r%3,i="",o=[],s=0,u=r-n;s<u;s+=16383)o.push(p(t,s,u<s+16383?u:s+16383));return 1==n?(i+=a[(e=t[r-1])>>2],i+=a[e<<4&63],i+="=="):2==n&&(i+=a[(e=(t[r-2]<<8)+t[r-1])>>10],i+=a[e>>4&63],i+=a[e<<2&63],i+="="),o.push(i),o.join("")}function r(t,e,r,n,i){var o,s,u=8*i-n-1,a=(1<<u)-1,f=a>>1,h=-7,l=r?i-1:0,c=r?-1:1,r=t[e+l];for(l+=c,o=r&(1<<-h)-1,r>>=-h,h+=u;0<h;o=256*o+t[e+l],l+=c,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=n;0<h;s=256*s+t[e+l],l+=c,h-=8);if(0===o)o=1-f;else{if(o===a)return s?NaN:1/0*(r?-1:1);s+=Math.pow(2,n),o-=f}return(r?-1:1)*s*Math.pow(2,o-n)}function o(t,e,r,n,i,o){var s,u,a=8*o-i-1,f=(1<<a)-1,h=f>>1,l=23===i?5.960464477539062e-8:0,c=n?0:o-1,p=n?1:-1,o=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(u=isNaN(e)?1:0,s=f):(e*(n=Math.pow(2,-(s=Math.floor(Math.log(e)/Math.LN2))))<1&&(s--,n*=2),(e+=s+h<1?l*Math.pow(2,1-h):l/n)*n<2||(s++,n/=2),s+h<f?s+h<1?(u=e*Math.pow(2,h-1)*Math.pow(2,i),s=0):(u=(e*n-1)*Math.pow(2,i),s+=h):(u=0,s=f));8<=i;t[r+c]=255&u,c+=p,u/=256,i-=8);for(s=s<<i|u,a+=i;0<a;t[r+c]=255&s,c+=p,s/=256,a-=8);t[r+c-p]|=128*o}var n={}.toString,s=Array.isArray||function(t){return"[object Array]"==n.call(t)};function i(){return y.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function d(t,e){if(i()<e)throw new RangeError("Invalid typed array length");return y.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=y.prototype:(t=null===t?new y(e):t).length=e,t}function y(t,e,r){if(!(y.TYPED_ARRAY_SUPPORT||this instanceof y))return new y(t,e,r);if("number"!=typeof t)return g(this,t,e,r);if("string"==typeof e)throw Error("If encoding is specified then the first argument must be a string");return w(this,t)}function g(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);y.TYPED_ARRAY_SUPPORT?(t=e).__proto__=y.prototype:t=m(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!y.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|A(e,r),r=(t=d(t,n)).write(e,r);r!==n&&(t=t.slice(0,r));return t}(t,e,r):function(t,e){if(b(e)){var r=0|E(e.length);return 0===(t=d(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?d(t,0):m(t,e);if("Buffer"===e.type&&s(e.data))return m(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function v(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function w(t,e){if(v(e),t=d(t,e<0?0:0|E(e)),!y.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function m(t,e){var r=e.length<0?0:0|E(e.length);t=d(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function E(t){if(t>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|t}function b(t){return null!=t&&t._isBuffer}function A(t,e){if(b(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;var r=(t="string"!=typeof t?""+t:t).length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return j(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(t).length;default:if(n)return j(t).length;e=(""+e).toLowerCase(),n=!0}}function _(t,e,r){var n,i,o,s=!1;if(this.length<(e=void 0===e||0>e?0:e))return"";if((r=void 0===r||r>this.length?this.length:r)<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t=t||"utf8";;)switch(t){case"hex":return function(t,e,r){var n=t.length;e&&0<=e||(e=0);r&&0<=r&&r<=n||(r=n);for(var i="",o=e;o<r;++o)i+=function(t){return t<16?"0"+t.toString(16):t.toString(16)}(t[o]);return i}(this,e,r);case"utf8":case"utf-8":return S(this,e,r);case"ascii":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}(this,e,r);case"latin1":case"binary":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}(this,e,r);case"base64":return n=this,o=r,u(0===(i=e)&&o===n.length?n:n.slice(i,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}(this,e,r);default:if(s)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),s=!0}}function R(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function P(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),t.length>(r=(r=isNaN(r=+r)?i?0:t.length-1:r)<0?t.length+r:r)){if(r<0){if(!i)return-1;r=0}}else{if(i)return-1;r=t.length-1}if(b(e="string"==typeof e?y.from(e,n):e))return 0===e.length?-1:T(t,e,r,n,i);if("number"==typeof e)return e&=255,y.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(t,e,r):T(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function T(t,e,r,n,i){var o=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=(""+n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s/=o=2,u/=2,r/=2}function a(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i)for(var f=-1,h=r;h<s;h++)if(a(t,h)===a(e,-1===f?0:h-f)){if(h-(f=-1===f?h:f)+1===u)return f*o}else-1!==f&&(h-=h-f),f=-1;else for(h=r=s<r+u?s-u:r;0<=h;h--){for(var l=!0,c=0;c<u;c++)if(a(t,h+c)!==a(e,c)){l=!1;break}if(l)return h}return-1}function L(t,e,r,n){return $(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function U(t,e,r,n){return $(function(t,e){for(var r,n,i=[],o=0;o<t.length&&(e-=2)>=0;++o)r=t.charCodeAt(o),n=r>>8,i.push(r%256),i.push(n);return i}(e,t.length-r),t,r,n)}function S(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,u,a,f=t[i],h=null,l=239<f?4:223<f?3:191<f?2:1;if(i+l<=r)switch(l){case 1:f<128&&(h=f);break;case 2:128==(192&(o=t[i+1]))&&127<(a=(31&f)<<6|63&o)&&(h=a);break;case 3:s=t[i+2],128==(192&(o=t[i+1]))&&128==(192&s)&&2047<(a=(15&f)<<12|(63&o)<<6|63&s)&&(a<55296||57343<a)&&(h=a);break;case 4:s=t[i+2],u=t[i+3],128==(192&(o=t[i+1]))&&128==(192&s)&&128==(192&u)&&65535<(a=(15&f)<<18|(63&o)<<12|(63&s)<<6|63&u)&&a<1114112&&(h=a)}null===h?(h=65533,l=1):65535<h&&(n.push((h-=65536)>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=l}return function(t){var e=t.length;if(e<=I)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=I));return r}(n)}y.TYPED_ARRAY_SUPPORT=void 0===e.TYPED_ARRAY_SUPPORT||e.TYPED_ARRAY_SUPPORT,y.poolSize=8192,y._augment=function(t){return t.__proto__=y.prototype,t},y.from=function(t,e,r){return g(null,t,e,r)},y.TYPED_ARRAY_SUPPORT&&(y.prototype.__proto__=Uint8Array.prototype,y.__proto__=Uint8Array),y.alloc=function(t,e,r){return n=null,e=e,r=r,v(t=t),0<t&&void 0!==e?"string"==typeof r?d(n,t).fill(e,r):d(n,t).fill(e):d(n,t);var n},y.allocUnsafe=function(t){return w(null,t)},y.allocUnsafeSlow=function(t){return w(null,t)},y.isBuffer=function(t){return null!=t&&(!!t._isBuffer||W(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&W(t.slice(0,0))}(t))},y.compare=function(t,e){if(!b(t)||!b(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},y.isEncoding=function(t){switch((""+t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},y.concat=function(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return y.alloc(0);if(void 0===e)for(i=e=0;i<t.length;++i)e+=t[i].length;for(var r=y.allocUnsafe(e),n=0,i=0;i<t.length;++i){var o=t[i];if(!b(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n),n+=o.length}return r},y.byteLength=A,y.prototype._isBuffer=!0,y.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)R(this,e,e+1);return this},y.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)R(this,e,e+3),R(this,e+1,e+2);return this},y.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)R(this,e,e+7),R(this,e+1,e+6),R(this,e+2,e+5),R(this,e+3,e+4);return this},y.prototype.toString=function(){var t=0|this.length;return 0==t?"":0===arguments.length?S(this,0,t):_.apply(this,arguments)},y.prototype.equals=function(t){if(!b(t))throw new TypeError("Argument must be a Buffer");return this===t||0===y.compare(this,t)},y.prototype.inspect=function(){var t="";return 0<this.length&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(t+=" ... ")),"<Buffer "+t+">"},y.prototype.compare=function(t,e,r,n,i){if(!b(t))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),(e=void 0===e?0:e)<0||t.length<r||n<0||this.length<i)throw new RangeError("out of range index");if(i<=n&&r<=e)return 0;if(i<=n)return-1;if(r<=e)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(e>>>=0),u=Math.min(o,s),a=this.slice(n,i),f=t.slice(e,r),h=0;h<u;++h)if(a[h]!==f[h]){o=a[h],s=f[h];break}return o<s?-1:s<o?1:0},y.prototype.includes=function(t,e,r){return!!~this.indexOf(t,e,r)},y.prototype.indexOf=function(t,e,r){return P(this,t,e,r,!0)},y.prototype.lastIndexOf=function(t,e,r){return P(this,t,e,r,!1)},y.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if(void 0!==r&&r<=i||(r=i),0<t.length&&(r<0||e<0)||this.length<e)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var o,s,u,a=!1;;)switch(n){case"hex":return function(t,e,r,n){var i=t.length-(r=+(""+r)||0);if(n&&i>=(n=+(""+n))||(n=i),(i=e.length)%2!=0)throw new TypeError("Invalid hex string");i/2<n&&(n=i/2);for(var o=0;o<n;++o){var s=parseInt(e.substr(2*o,2),16);if(isNaN(s))return o;t[r+o]=s}return o}(this,t,e,r);case"utf8":case"utf-8":return u=r,$(j(t,(o=this).length-(s=e)),o,s,u);case"ascii":return L(this,t,e,r);case"latin1":case"binary":return L(this,t,e,r);case"base64":return o=this,s=e,u=r,$(z(t),o,s,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,t,e,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},y.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function C(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(r<t+e)throw new RangeError("Trying to access beyond buffer length")}function B(t,e,r,n,i,o){if(!b(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<e||e<o)throw new RangeError('"value" argument is out of bounds');if(t.length<r+n)throw new RangeError("Index out of range")}function Y(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function x(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function O(t,e,r,n){if(t.length<r+n)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(t,e,r,n,i){return i||O(t,0,r,4),o(t,e,r,n,23,4),r+4}function D(t,e,r,n,i){return i||O(t,0,r,8),o(t,e,r,n,52,8),r+8}y.prototype.slice=function(t,e){var r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),e<t&&(e=t),y.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=y.prototype;else for(var n=e-t,i=new y(n,void 0),o=0;o<n;++o)i[o]=this[o+t];return i},y.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},y.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t+--e],i=1;0<e&&(i*=256);)n+=this[t+--e]*i;return n},y.prototype.readUInt8=function(t,e){return e||C(t,1,this.length),this[t]},y.prototype.readUInt16LE=function(t,e){return e||C(t,2,this.length),this[t]|this[t+1]<<8},y.prototype.readUInt16BE=function(t,e){return e||C(t,2,this.length),this[t]<<8|this[t+1]},y.prototype.readUInt32LE=function(t,e){return e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},y.prototype.readUInt32BE=function(t,e){return e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},y.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n<(i*=128)||(n-=Math.pow(2,8*e)),n},y.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=e,i=1,o=this[t+--n];0<n&&(i*=256);)o+=this[t+--n]*i;return o<(i*=128)||(o-=Math.pow(2,8*e)),o},y.prototype.readInt8=function(t,e){return e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},y.prototype.readInt16LE=function(t,e){e||C(t,2,this.length);t=this[t]|this[t+1]<<8;return 32768&t?4294901760|t:t},y.prototype.readInt16BE=function(t,e){e||C(t,2,this.length);t=this[t+1]|this[t]<<8;return 32768&t?4294901760|t:t},y.prototype.readInt32LE=function(t,e){return e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},y.prototype.readInt32BE=function(t,e){return e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},y.prototype.readFloatLE=function(t,e){return e||C(t,4,this.length),r(this,t,!0,23,4)},y.prototype.readFloatBE=function(t,e){return e||C(t,4,this.length),r(this,t,!1,23,4)},y.prototype.readDoubleLE=function(t,e){return e||C(t,8,this.length),r(this,t,!0,52,8)},y.prototype.readDoubleBE=function(t,e){return e||C(t,8,this.length),r(this,t,!1,52,8)},y.prototype.writeUIntLE=function(t,e,r,n){t=+t,e|=0,r|=0,n||B(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},y.prototype.writeUIntBE=function(t,e,r,n){t=+t,e|=0,r|=0,n||B(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;0<=--i&&(o*=256);)this[e+i]=t/o&255;return e+r},y.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,1,255,0),this[e]=255&(t=!y.TYPED_ARRAY_SUPPORT?Math.floor(t):t),e+1},y.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,65535,0),y.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Y(this,t,e,!0),e+2},y.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,65535,0),y.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Y(this,t,e,!1),e+2},y.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,4294967295,0),y.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):x(this,t,e,!0),e+4},y.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,4294967295,0),y.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):x(this,t,e,!1),e+4},y.prototype.writeIntLE=function(t,e,r,n){t=+t,e|=0,n||B(this,t,e,r,(n=Math.pow(2,8*r-1))-1,-n);var i=0,o=1,s=0;for(this[e]=255&t;++i<r&&(o*=256);)this[e+i]=(t/o>>0)-(s=t<0&&0===s&&0!==this[e+i-1]?1:s)&255;return e+r},y.prototype.writeIntBE=function(t,e,r,n){t=+t,e|=0,n||B(this,t,e,r,(n=Math.pow(2,8*r-1))-1,-n);var i=r-1,o=1,s=0;for(this[e+i]=255&t;0<=--i&&(o*=256);)this[e+i]=(t/o>>0)-(s=t<0&&0===s&&0!==this[e+i+1]?1:s)&255;return e+r},y.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,1,127,-128),this[e]=255&(t=(t=!y.TYPED_ARRAY_SUPPORT?Math.floor(t):t)<0?255+t+1:t),e+1},y.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,32767,-32768),y.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Y(this,t,e,!0),e+2},y.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,32767,-32768),y.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Y(this,t,e,!1),e+2},y.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,2147483647,-2147483648),y.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):x(this,t,e,!0),e+4},y.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),y.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):x(this,t,e,!1),e+4},y.prototype.writeFloatLE=function(t,e,r){return M(this,t,e,!0,r)},y.prototype.writeFloatBE=function(t,e,r){return M(this,t,e,!1,r)},y.prototype.writeDoubleLE=function(t,e,r){return D(this,t,e,!0,r)},y.prototype.writeDoubleBE=function(t,e,r){return D(this,t,e,!1,r)},y.prototype.copy=function(t,e,r,n){if(r=r||0,(n=0<(n=!n&&0!==n?this.length:n)&&n<r?r:n)===r)return 0;if(0===t.length||0===this.length)return 0;if((e=(e=e>=t.length?t.length:e)||0)<0)throw new RangeError("targetStart out of bounds");if(r<0||this.length<=r)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");var i,o=(n=t.length-e<(n=this.length<n?this.length:n)-r?t.length-e+r:n)-r;if(this===t&&r<e&&e<n)for(i=o-1;0<=i;--i)t[i+e]=this[i+r];else if(o<1e3||!y.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},y.prototype.fill=function(t,e,r,n){if("string"==typeof t){var i;if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1!==t.length||(i=t.charCodeAt(0))<256&&(t=i),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!y.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(t=t||0))for(u=e;u<r;++u)this[u]=t;else for(var o=b(t)?t:j(""+new y(t,n)),s=o.length,u=0;u<r-e;++u)this[u+e]=o[u%s];return this};var k,N=/[^+\/0-9A-Za-z-_]/g;function j(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if(55295<(r=t.charCodeAt(s))&&r<57344){if(!i){if(56319<r){-1<(e-=3)&&o.push(239,191,189);continue}if(s+1===n){-1<(e-=3)&&o.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(e-=3)&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(e-=3)&&o.push(239,191,189);if(i=null,r<128){if(--e<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(1114112<=r)throw Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function z(t){return function(t){var e;l||c();var r=t.length;if(0<r%4)throw Error("Invalid string. Length must be a multiple of 4");for(var n,i=new h(3*r/4-(n="="===t[r-2]?2:"="===t[r-1]?1:0)),o=0<n?r-4:r,s=0,u=0;u<o;u+=4,0)e=f[t.charCodeAt(u)]<<18|f[t.charCodeAt(u+1)]<<12|f[t.charCodeAt(u+2)]<<6|f[t.charCodeAt(u+3)],i[s++]=e>>16&255,i[s++]=e>>8&255,i[s++]=255&e;return 2==n?(e=f[t.charCodeAt(u)]<<2|f[t.charCodeAt(u+1)]>>4,i[s++]=255&e):1==n&&(e=f[t.charCodeAt(u)]<<10|f[t.charCodeAt(u+1)]<<4|f[t.charCodeAt(u+2)]>>2,i[s++]=e>>8&255,i[s++]=255&e),i}(function(t){var e;if((t=((e=t).trim?e.trim():e.replace(/^\s+|\s+$/g,"")).replace(N,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function $(t,e,r,n){for(var i=0;i<n&&(e.length>i+r&&t.length>i);++i)e[i+r]=t[i];return i}function W(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function J(){}function F(){F.init.call(this)}function K(t){return void 0===t._maxListeners?F.defaultMaxListeners:t._maxListeners}function V(t,e,r,n){var i,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return(i=t._events)?(i.newListener&&(t.emit("newListener",e,r.listener||r),i=t._events),o=i[e]):(i=t._events=new J,t._eventsCount=0),o?("function"==typeof o?o=i[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),o.warned||(n=K(t))&&0<n&&n<o.length&&(o.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+o.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=t,n.type=e,n.count=o.length,n=n,"function"==typeof console.warn?console.warn(n):console.log(n))):(o=i[e]=r,++t._eventsCount),t}function H(t,e,r){var n=!1;function i(){t.removeListener(e,i),n||(n=!0,r.apply(t,arguments))}return i.listener=r,i}function q(t){var e=this._events;if(e){t=e[t];if("function"==typeof t)return 1;if(t)return t.length}return 0}function X(t,e){for(var r=Array(e);e--;)r[e]=t[e];return r}J.prototype=Object.create(null),(F.EventEmitter=F).usingDomains=!1,F.prototype.domain=void 0,F.prototype._events=void 0,F.prototype._maxListeners=void 0,F.defaultMaxListeners=10,F.init=function(){this.domain=null,F.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new J,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},F.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},F.prototype.getMaxListeners=function(){return K(this)},F.prototype.emit=function(t){var e,r,n,i="error"===t,o=this._events;if(o)i=i&&null==o.error;else if(!i)return!1;if(s=this.domain,i){if(i=arguments[1],s)return(i=i||Error('Uncaught, unspecified "error" event')).domainEmitter=this,i.domain=s,i.domainThrown=!1,s.emit("error",i),!1;if(i instanceof Error)throw i;var s=Error('Uncaught, unspecified "error" event. ('+i+")");throw s.context=i,s}if(!(e=o[t]))return!1;var u,a="function"==typeof e;switch(u=arguments.length){case 1:!function(t,e,r){if(e)t.call(r);else for(var n=t.length,i=X(t,n),o=0;o<n;++o)i[o].call(r)}(e,a,this);break;case 2:!function(t,e,r,n){if(e)t.call(r,n);else for(var i=t.length,o=X(t,i),s=0;s<i;++s)o[s].call(r,n)}(e,a,this,arguments[1]);break;case 3:!function(t,e,r,n,i){if(e)t.call(r,n,i);else for(var o=t.length,s=X(t,o),u=0;u<o;++u)s[u].call(r,n,i)}(e,a,this,arguments[1],arguments[2]);break;case 4:!function(t,e,r,n,i,o){if(e)t.call(r,n,i,o);else for(var s=t.length,u=X(t,s),a=0;a<s;++a)u[a].call(r,n,i,o)}(e,a,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=Array(u-1),n=1;n<u;n++)r[n-1]=arguments[n];!function(t,e,r,n){if(e)t.apply(r,n);else for(var i=t.length,o=X(t,i),s=0;s<i;++s)o[s].apply(r,n)}(e,a,this,r)}return!0},F.prototype.addListener=function(t,e){return V(this,t,e,!1)},F.prototype.on=F.prototype.addListener,F.prototype.prependListener=function(t,e){return V(this,t,e,!0)},F.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,H(this,t,e)),this},F.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,H(this,t,e)),this},F.prototype.removeListener=function(t,e){var r,n,i,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[t]))return this;if(r===e||r.listener&&r.listener===e)0==--this._eventsCount?this._events=new J:(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,o=r.length;0<o--;)if(r[o]===e||r[o].listener&&r[o].listener===e){s=r[o].listener,i=o;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new J,this;delete n[t]}else!function(t,e){for(var r=e,n=r+1,i=t.length;n<i;r+=1,n+=1)t[r]=t[n];t.pop()}(r,i);n.removeListener&&this.emit("removeListener",t,s||e)}return this},F.prototype.removeAllListeners=function(t){var e,r=this._events;if(!r)return this;if(!r.removeListener)return 0===arguments.length?(this._events=new J,this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=new J:delete r[t]),this;if(0===arguments.length){for(var n,i=Object.keys(r),o=0;o<i.length;++o)"removeListener"!==(n=i[o])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new J,this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)for(;this.removeListener(t,e[e.length-1]),e[0];);return this},F.prototype.listeners=function(t){var e=this._events,r=e&&(r=e[t])?"function"==typeof r?[r.listener||r]:function(t){for(var e=Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(r):[];return r},F.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):q.call(t,e)},F.prototype.listenerCount=q,F.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};var Z=new Uint8Array(16);var G=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var Q=[],tt=0;tt<256;++tt)Q.push((tt+256).toString(16).substr(1));function et(t,e){e=1<arguments.length&&void 0!==e?e:0,t=(Q[t[e+0]]+Q[t[e+1]]+Q[t[e+2]]+Q[t[e+3]]+"-"+Q[t[e+4]]+Q[t[e+5]]+"-"+Q[t[e+6]]+Q[t[e+7]]+"-"+Q[t[e+8]]+Q[t[e+9]]+"-"+Q[t[e+10]]+Q[t[e+11]]+Q[t[e+12]]+Q[t[e+13]]+Q[t[e+14]]+Q[t[e+15]]).toLowerCase();if("string"!=typeof(e=t)||!G.test(e))throw TypeError("Stringified UUID is invalid");return t}function rt(t,e,r){var n=(t=t||{}).random||(t.rng||function(){if(!k&&!(k="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return k(Z)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=n[i];return e}return et(n)}var nt={host:"https://insignia-6t9a4.ondigitalocean.app",bitclout:"https://identity.bitclout.com"};class it{constructor(t){this.opts=t||{},this.opts.api=(null==t?void 0:t.api)||nt.bitclout,this.opts.test=null==t?void 0:t.test,this.identityWindow=null,this.iframeInitialized=!1,this.iframe=document.getElementById("identity"),this.eventEmitter=new F,window.addEventListener("message",async t=>this.handleMessage(t),!1)}async handleMessage(e){var t;const r=this;if("identity"===e.data.service){const n=null!==(t={initialize:async()=>{e.source.postMessage({id:e.data.id,service:e.data.service},e.origin),r.iframeInitialized||(await r.sendInfoSync(),r.iframeInitialized=!0)},login:async()=>{var t;r.identityWindow&&(r.identityWindow.close(),r.identityWindow=null,localStorage.setItem("identityUser",JSON.stringify(e.data.payload.users[e.data.payload.publicKeyAdded])),e.data.payload.publicKeyAdded?(t=e.data.payload.users[e.data.payload.publicKeyAdded],t=await r.sendJWTSync({accessLevel:t.accessLevel,accessLevelHmac:t.accessLevelHmac,encryptedSeedHex:t.encryptedSeedHex}),r.eventEmitter.emit("login",{token:t,publicKey:e.data.payload.publicKeyAdded})):r.eventEmitter.emit("logout",{}))}}[e.data.method])&&void 0!==t?t:function(){e.data.payload.jwt?r.eventEmitter.emit(e.data.id,e.data.payload.jwt):r.eventEmitter.emit(e.data.id,e.data.payload)};await n()}}sendInfoSync(){return this.send({method:"info",payload:{}})}async send(n){return new Promise((e,t)=>{var r;this.iframe?(r=rt(),this.iframe.contentWindow.postMessage({id:r,service:"identity",method:n.method,payload:n.payload},"*"),this.eventEmitter.on(r,t=>e(t))):t(Error("Not initialized yet"))})}sendJWTSync(t){return this.send({method:"jwt",payload:t})}get pos(){return{x:window.outerHeight/2+window.screenY-500,y:window.outerWidth/2+window.screenX-400}}logoutAsync(t){return new Promise(e=>{this.identityWindow=window.open(`${this.opts.api}/logout?publicKey=${t}`,"logout",`toolbar=no, width=800, height=1000, top=${this.pos.x}, left=${this.pos.y}`),this.eventEmitter.on("logout",t=>e(t))})}async loginAsync(n){return new Promise((e,r)=>{try{const t=[];this.opts.test&&t.push("testnet=true"),null!=n&&t.push(`accessLevelRequest=${n}`),this.identityWindow=window.open(`${this.opts.api}/log-in${0<t.length?"?":""}${t.join("&")}`,void 0,`toolbar=no, width=800, height=1000, top=${this.pos.x}, left=${this.pos.y}`),this.eventEmitter.on("login",t=>e(t))}catch(t){r(t)}})}}t.BitClout=it,t.WebClient=class{constructor(t){this.opts=t,this.opts.test=this.opts.test||!1,this.bitclout=new it({test:this.opts.test})}get bitcloutAPI(){return this.bitclout}get token(){const r=this;return{authenticate:async t=>async function(t=nt.host,e,r){t=`${t}/v1/authenticate`,r=JSON.stringify(r);const n=await fetch(t,{method:"POST",headers:{"Content-type":"application/json","App-Id":e},body:r});if(r=await n.text(),(r=JSON.parse(r||{})).error)throw r.error;return r}(r.opts.host,r.opts.appId,t),revoke:async t=>{var e=JSON.parse(""+y.from(t.refreshToken.split(".")[1],"base64"));return await this.bitcloutAPI.logoutAsync(e.externalId),async function(t=nt.host,e,r){t=`${t}/v1/revoke`,r=JSON.stringify(r);const n=await fetch(t,{method:"POST",headers:{"Content-type":"application/json","App-Id":e},body:r});if(r=await n.text(),(r=JSON.parse(r||{})).error)throw r.error;return!0}(r.opts.host,r.opts.appId,t)}}}},Object.defineProperty(t,"__esModule",{value:!0})});
