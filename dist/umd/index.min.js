!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("url-parse")):"function"==typeof define&&define.amd?define(["exports","url-parse"],e):e((t=t||self).insignia={},t.Url)}(this,function(t,u){"use strict";u=u&&u.hasOwnProperty("default")?u.default:u;var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=[],h=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,l=!1;function p(){l=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0;e<64;++e)f[e]=t[e],h[t.charCodeAt(e)]=e;h[45]=62,h[95]=63}function d(t,e,r){for(var n,i=[],o=e;o<r;o+=3)i.push(f[(n=(t[o]<<16)+(t[o+1]<<8)+t[o+2])>>18&63]+f[n>>12&63]+f[n>>6&63]+f[63&n]);return i.join("")}function a(t){var e;l||p();for(var r=t.length,n=r%3,i="",o=[],s=0,a=r-n;s<a;s+=16383)o.push(d(t,s,a<s+16383?a:s+16383));return 1==n?(i+=f[(e=t[r-1])>>2],i+=f[e<<4&63],i+="=="):2==n&&(i+=f[(e=(t[r-2]<<8)+t[r-1])>>10],i+=f[e>>4&63],i+=f[e<<2&63],i+="="),o.push(i),o.join("")}function r(t,e,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,f=u>>1,h=-7,c=r?i-1:0,l=r?-1:1,r=t[e+c];for(c+=l,o=r&(1<<-h)-1,r>>=-h,h+=a;0<h;o=256*o+t[e+c],c+=l,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=n;0<h;s=256*s+t[e+c],c+=l,h-=8);if(0===o)o=1-f;else{if(o===u)return s?NaN:1/0*(r?-1:1);s+=Math.pow(2,n),o-=f}return(r?-1:1)*s*Math.pow(2,o-n)}function o(t,e,r,n,i,o){var s,a,u=8*o-i-1,f=(1<<u)-1,h=f>>1,c=23===i?5.960464477539062e-8:0,l=n?0:o-1,p=n?1:-1,o=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(a=isNaN(e)?1:0,s=f):(e*(n=Math.pow(2,-(s=Math.floor(Math.log(e)/Math.LN2))))<1&&(s--,n*=2),(e+=s+h<1?c*Math.pow(2,1-h):c/n)*n<2||(s++,n/=2),s+h<f?s+h<1?(a=e*Math.pow(2,h-1)*Math.pow(2,i),s=0):(a=(e*n-1)*Math.pow(2,i),s+=h):(a=0,s=f));8<=i;t[r+l]=255&a,l+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;0<u;t[r+l]=255&s,l+=p,s/=256,u-=8);t[r+l-p]|=128*o}var n={}.toString,s=Array.isArray||function(t){return"[object Array]"==n.call(t)};function i(){return g.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function y(t,e){if(i()<e)throw new RangeError("Invalid typed array length");return g.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=g.prototype:(t=null===t?new g(e):t).length=e,t}function g(t,e,r){if(!(g.TYPED_ARRAY_SUPPORT||this instanceof g))return new g(t,e,r);if("number"!=typeof t)return v(this,t,e,r);if("string"==typeof e)throw Error("If encoding is specified then the first argument must be a string");return m(this,t)}function v(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);g.TYPED_ARRAY_SUPPORT?(t=e).__proto__=g.prototype:t=b(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!g.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|_(e,r),r=(t=y(t,n)).write(e,r);r!==n&&(t=t.slice(0,r));return t}(t,e,r):function(t,e){if(A(e)){var r=0|E(e.length);return 0===(t=y(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?y(t,0):b(t,e);if("Buffer"===e.type&&s(e.data))return b(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function w(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function m(t,e){if(w(e),t=y(t,e<0?0:0|E(e)),!g.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function b(t,e){var r=e.length<0?0:0|E(e.length);t=y(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function E(t){if(t>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|t}function A(t){return null!=t&&t._isBuffer}function _(t,e){if(A(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;var r=(t="string"!=typeof t?""+t:t).length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return $(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(t).length;default:if(n)return $(t).length;e=(""+e).toLowerCase(),n=!0}}function R(t,e,r){var n,i,o,s=!1;if(this.length<(e=void 0===e||0>e?0:e))return"";if((r=void 0===r||r>this.length?this.length:r)<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t=t||"utf8";;)switch(t){case"hex":return function(t,e,r){var n=t.length;e&&0<=e||(e=0);r&&0<=r&&r<=n||(r=n);for(var i="",o=e;o<r;++o)i+=function(t){return t<16?"0"+t.toString(16):t.toString(16)}(t[o]);return i}(this,e,r);case"utf8":case"utf-8":return I(this,e,r);case"ascii":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}(this,e,r);case"latin1":case"binary":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}(this,e,r);case"base64":return n=this,o=r,a(0===(i=e)&&o===n.length?n:n.slice(i,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}(this,e,r);default:if(s)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),s=!0}}function P(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function T(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),t.length>(r=(r=isNaN(r=+r)?i?0:t.length-1:r)<0?t.length+r:r)){if(r<0){if(!i)return-1;r=0}}else{if(i)return-1;r=t.length-1}if(A(e="string"==typeof e?g.from(e,n):e))return 0===e.length?-1:L(t,e,r,n,i);if("number"==typeof e)return e&=255,g.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(t,e,r):L(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function L(t,e,r,n,i){var o=1,s=t.length,a=e.length;if(void 0!==n&&("ucs2"===(n=(""+n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s/=o=2,a/=2,r/=2}function u(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i)for(var f=-1,h=r;h<s;h++)if(u(t,h)===u(e,-1===f?0:h-f)){if(h-(f=-1===f?h:f)+1===a)return f*o}else-1!==f&&(h-=h-f),f=-1;else for(h=r=s<r+a?s-a:r;0<=h;h--){for(var c=!0,l=0;l<a;l++)if(u(t,h+l)!==u(e,l)){c=!1;break}if(c)return h}return-1}function S(t,e,r,n){return W(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function U(t,e,r,n){return W(function(t,e){for(var r,n,i=[],o=0;o<t.length&&(e-=2)>=0;++o)r=t.charCodeAt(o),n=r>>8,i.push(r%256),i.push(n);return i}(e,t.length-r),t,r,n)}function I(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,a,u,f=t[i],h=null,c=239<f?4:223<f?3:191<f?2:1;if(i+c<=r)switch(c){case 1:f<128&&(h=f);break;case 2:128==(192&(o=t[i+1]))&&127<(u=(31&f)<<6|63&o)&&(h=u);break;case 3:s=t[i+2],128==(192&(o=t[i+1]))&&128==(192&s)&&2047<(u=(15&f)<<12|(63&o)<<6|63&s)&&(u<55296||57343<u)&&(h=u);break;case 4:s=t[i+2],a=t[i+3],128==(192&(o=t[i+1]))&&128==(192&s)&&128==(192&a)&&65535<(u=(15&f)<<18|(63&o)<<12|(63&s)<<6|63&a)&&u<1114112&&(h=u)}null===h?(h=65533,c=1):65535<h&&(n.push((h-=65536)>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}return function(t){var e=t.length;if(e<=O)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=O));return r}(n)}g.TYPED_ARRAY_SUPPORT=void 0===e.TYPED_ARRAY_SUPPORT||e.TYPED_ARRAY_SUPPORT,g.poolSize=8192,g._augment=function(t){return t.__proto__=g.prototype,t},g.from=function(t,e,r){return v(null,t,e,r)},g.TYPED_ARRAY_SUPPORT&&(g.prototype.__proto__=Uint8Array.prototype,g.__proto__=Uint8Array),g.alloc=function(t,e,r){return n=null,e=e,r=r,w(t=t),0<t&&void 0!==e?"string"==typeof r?y(n,t).fill(e,r):y(n,t).fill(e):y(n,t);var n},g.allocUnsafe=function(t){return m(null,t)},g.allocUnsafeSlow=function(t){return m(null,t)},g.isBuffer=function(t){return null!=t&&(!!t._isBuffer||F(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&F(t.slice(0,0))}(t))},g.compare=function(t,e){if(!A(t)||!A(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},g.isEncoding=function(t){switch((""+t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},g.concat=function(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return g.alloc(0);if(void 0===e)for(i=e=0;i<t.length;++i)e+=t[i].length;for(var r=g.allocUnsafe(e),n=0,i=0;i<t.length;++i){var o=t[i];if(!A(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n),n+=o.length}return r},g.byteLength=_,g.prototype._isBuffer=!0,g.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)P(this,e,e+1);return this},g.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)P(this,e,e+3),P(this,e+1,e+2);return this},g.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)P(this,e,e+7),P(this,e+1,e+6),P(this,e+2,e+5),P(this,e+3,e+4);return this},g.prototype.toString=function(){var t=0|this.length;return 0==t?"":0===arguments.length?I(this,0,t):R.apply(this,arguments)},g.prototype.equals=function(t){if(!A(t))throw new TypeError("Argument must be a Buffer");return this===t||0===g.compare(this,t)},g.prototype.inspect=function(){var t="";return 0<this.length&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(t+=" ... ")),"<Buffer "+t+">"},g.prototype.compare=function(t,e,r,n,i){if(!A(t))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),(e=void 0===e?0:e)<0||t.length<r||n<0||this.length<i)throw new RangeError("out of range index");if(i<=n&&r<=e)return 0;if(i<=n)return-1;if(r<=e)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(e>>>=0),a=Math.min(o,s),u=this.slice(n,i),f=t.slice(e,r),h=0;h<a;++h)if(u[h]!==f[h]){o=u[h],s=f[h];break}return o<s?-1:s<o?1:0},g.prototype.includes=function(t,e,r){return!!~this.indexOf(t,e,r)},g.prototype.indexOf=function(t,e,r){return T(this,t,e,r,!0)},g.prototype.lastIndexOf=function(t,e,r){return T(this,t,e,r,!1)},g.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if(void 0!==r&&r<=i||(r=i),0<t.length&&(r<0||e<0)||this.length<e)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var o,s,a,u=!1;;)switch(n){case"hex":return function(t,e,r,n){var i=t.length-(r=+(""+r)||0);if(n&&i>=(n=+(""+n))||(n=i),(i=e.length)%2!=0)throw new TypeError("Invalid hex string");i/2<n&&(n=i/2);for(var o=0;o<n;++o){var s=parseInt(e.substr(2*o,2),16);if(isNaN(s))return o;t[r+o]=s}return o}(this,t,e,r);case"utf8":case"utf-8":return a=r,W($(t,(o=this).length-(s=e)),o,s,a);case"ascii":return S(this,t,e,r);case"latin1":case"binary":return S(this,t,e,r);case"base64":return o=this,s=e,a=r,W(z(t),o,s,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,t,e,r);default:if(u)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),u=!0}},g.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var O=4096;function C(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(r<t+e)throw new RangeError("Trying to access beyond buffer length")}function B(t,e,r,n,i,o){if(!A(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<e||e<o)throw new RangeError('"value" argument is out of bounds');if(t.length<r+n)throw new RangeError("Index out of range")}function x(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function Y(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function M(t,e,r,n){if(t.length<r+n)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function j(t,e,r,n,i){return i||M(t,0,r,4),o(t,e,r,n,23,4),r+4}function D(t,e,r,n,i){return i||M(t,0,r,8),o(t,e,r,n,52,8),r+8}g.prototype.slice=function(t,e){var r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),e<t&&(e=t),g.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=g.prototype;else for(var n=e-t,i=new g(n,void 0),o=0;o<n;++o)i[o]=this[o+t];return i},g.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},g.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t+--e],i=1;0<e&&(i*=256);)n+=this[t+--e]*i;return n},g.prototype.readUInt8=function(t,e){return e||C(t,1,this.length),this[t]},g.prototype.readUInt16LE=function(t,e){return e||C(t,2,this.length),this[t]|this[t+1]<<8},g.prototype.readUInt16BE=function(t,e){return e||C(t,2,this.length),this[t]<<8|this[t+1]},g.prototype.readUInt32LE=function(t,e){return e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},g.prototype.readUInt32BE=function(t,e){return e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},g.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n<(i*=128)||(n-=Math.pow(2,8*e)),n},g.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=e,i=1,o=this[t+--n];0<n&&(i*=256);)o+=this[t+--n]*i;return o<(i*=128)||(o-=Math.pow(2,8*e)),o},g.prototype.readInt8=function(t,e){return e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},g.prototype.readInt16LE=function(t,e){e||C(t,2,this.length);t=this[t]|this[t+1]<<8;return 32768&t?4294901760|t:t},g.prototype.readInt16BE=function(t,e){e||C(t,2,this.length);t=this[t+1]|this[t]<<8;return 32768&t?4294901760|t:t},g.prototype.readInt32LE=function(t,e){return e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},g.prototype.readInt32BE=function(t,e){return e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},g.prototype.readFloatLE=function(t,e){return e||C(t,4,this.length),r(this,t,!0,23,4)},g.prototype.readFloatBE=function(t,e){return e||C(t,4,this.length),r(this,t,!1,23,4)},g.prototype.readDoubleLE=function(t,e){return e||C(t,8,this.length),r(this,t,!0,52,8)},g.prototype.readDoubleBE=function(t,e){return e||C(t,8,this.length),r(this,t,!1,52,8)},g.prototype.writeUIntLE=function(t,e,r,n){t=+t,e|=0,r|=0,n||B(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},g.prototype.writeUIntBE=function(t,e,r,n){t=+t,e|=0,r|=0,n||B(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;0<=--i&&(o*=256);)this[e+i]=t/o&255;return e+r},g.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,1,255,0),this[e]=255&(t=!g.TYPED_ARRAY_SUPPORT?Math.floor(t):t),e+1},g.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):x(this,t,e,!0),e+2},g.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):x(this,t,e,!1),e+2},g.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):Y(this,t,e,!0),e+4},g.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Y(this,t,e,!1),e+4},g.prototype.writeIntLE=function(t,e,r,n){t=+t,e|=0,n||B(this,t,e,r,(n=Math.pow(2,8*r-1))-1,-n);var i=0,o=1,s=0;for(this[e]=255&t;++i<r&&(o*=256);)this[e+i]=(t/o>>0)-(s=t<0&&0===s&&0!==this[e+i-1]?1:s)&255;return e+r},g.prototype.writeIntBE=function(t,e,r,n){t=+t,e|=0,n||B(this,t,e,r,(n=Math.pow(2,8*r-1))-1,-n);var i=r-1,o=1,s=0;for(this[e+i]=255&t;0<=--i&&(o*=256);)this[e+i]=(t/o>>0)-(s=t<0&&0===s&&0!==this[e+i+1]?1:s)&255;return e+r},g.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,1,127,-128),this[e]=255&(t=(t=!g.TYPED_ARRAY_SUPPORT?Math.floor(t):t)<0?255+t+1:t),e+1},g.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):x(this,t,e,!0),e+2},g.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):x(this,t,e,!1),e+2},g.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,2147483647,-2147483648),g.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):Y(this,t,e,!0),e+4},g.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Y(this,t,e,!1),e+4},g.prototype.writeFloatLE=function(t,e,r){return j(this,t,e,!0,r)},g.prototype.writeFloatBE=function(t,e,r){return j(this,t,e,!1,r)},g.prototype.writeDoubleLE=function(t,e,r){return D(this,t,e,!0,r)},g.prototype.writeDoubleBE=function(t,e,r){return D(this,t,e,!1,r)},g.prototype.copy=function(t,e,r,n){if(r=r||0,(n=0<(n=!n&&0!==n?this.length:n)&&n<r?r:n)===r)return 0;if(0===t.length||0===this.length)return 0;if((e=(e=e>=t.length?t.length:e)||0)<0)throw new RangeError("targetStart out of bounds");if(r<0||this.length<=r)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");var i,o=(n=t.length-e<(n=this.length<n?this.length:n)-r?t.length-e+r:n)-r;if(this===t&&r<e&&e<n)for(i=o-1;0<=i;--i)t[i+e]=this[i+r];else if(o<1e3||!g.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},g.prototype.fill=function(t,e,r,n){if("string"==typeof t){var i;if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1!==t.length||(i=t.charCodeAt(0))<256&&(t=i),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!g.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(t=t||0))for(a=e;a<r;++a)this[a]=t;else for(var o=A(t)?t:$(""+new g(t,n)),s=o.length,a=0;a<r-e;++a)this[a+e]=o[a%s];return this};var k,N=/[^+\/0-9A-Za-z-_]/g;function $(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if(55295<(r=t.charCodeAt(s))&&r<57344){if(!i){if(56319<r){-1<(e-=3)&&o.push(239,191,189);continue}if(s+1===n){-1<(e-=3)&&o.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(e-=3)&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(e-=3)&&o.push(239,191,189);if(i=null,r<128){if(--e<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(1114112<=r)throw Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function z(t){return function(t){var e;l||p();var r=t.length;if(0<r%4)throw Error("Invalid string. Length must be a multiple of 4");for(var n,i=new c(3*r/4-(n="="===t[r-2]?2:"="===t[r-1]?1:0)),o=0<n?r-4:r,s=0,a=0;a<o;a+=4,0)e=h[t.charCodeAt(a)]<<18|h[t.charCodeAt(a+1)]<<12|h[t.charCodeAt(a+2)]<<6|h[t.charCodeAt(a+3)],i[s++]=e>>16&255,i[s++]=e>>8&255,i[s++]=255&e;return 2==n?(e=h[t.charCodeAt(a)]<<2|h[t.charCodeAt(a+1)]>>4,i[s++]=255&e):1==n&&(e=h[t.charCodeAt(a)]<<10|h[t.charCodeAt(a+1)]<<4|h[t.charCodeAt(a+2)]>>2,i[s++]=e>>8&255,i[s++]=255&e),i}(function(t){var e;if((t=((e=t).trim?e.trim():e.replace(/^\s+|\s+$/g,"")).replace(N,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function W(t,e,r,n){for(var i=0;i<n&&(e.length>i+r&&t.length>i);++i)e[i+r]=t[i];return i}function F(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function J(){}function K(){K.init.call(this)}function V(t){return void 0===t._maxListeners?K.defaultMaxListeners:t._maxListeners}function H(t,e,r,n){var i,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return(i=t._events)?(i.newListener&&(t.emit("newListener",e,r.listener||r),i=t._events),o=i[e]):(i=t._events=new J,t._eventsCount=0),o?("function"==typeof o?o=i[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),o.warned||(n=V(t))&&0<n&&n<o.length&&(o.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+o.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=t,n.type=e,n.count=o.length,n=n,"function"==typeof console.warn?console.warn(n):console.log(n))):(o=i[e]=r,++t._eventsCount),t}function q(t,e,r){var n=!1;function i(){t.removeListener(e,i),n||(n=!0,r.apply(t,arguments))}return i.listener=r,i}function X(t){var e=this._events;if(e){t=e[t];if("function"==typeof t)return 1;if(t)return t.length}return 0}function Z(t,e){for(var r=Array(e);e--;)r[e]=t[e];return r}J.prototype=Object.create(null),(K.EventEmitter=K).usingDomains=!1,K.prototype.domain=void 0,K.prototype._events=void 0,K.prototype._maxListeners=void 0,K.defaultMaxListeners=10,K.init=function(){this.domain=null,K.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new J,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},K.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},K.prototype.getMaxListeners=function(){return V(this)},K.prototype.emit=function(t){var e,r,n,i="error"===t,o=this._events;if(o)i=i&&null==o.error;else if(!i)return!1;if(s=this.domain,i){if(i=arguments[1],s)return(i=i||Error('Uncaught, unspecified "error" event')).domainEmitter=this,i.domain=s,i.domainThrown=!1,s.emit("error",i),!1;if(i instanceof Error)throw i;var s=Error('Uncaught, unspecified "error" event. ('+i+")");throw s.context=i,s}if(!(e=o[t]))return!1;var a,u="function"==typeof e;switch(a=arguments.length){case 1:!function(t,e,r){if(e)t.call(r);else for(var n=t.length,i=Z(t,n),o=0;o<n;++o)i[o].call(r)}(e,u,this);break;case 2:!function(t,e,r,n){if(e)t.call(r,n);else for(var i=t.length,o=Z(t,i),s=0;s<i;++s)o[s].call(r,n)}(e,u,this,arguments[1]);break;case 3:!function(t,e,r,n,i){if(e)t.call(r,n,i);else for(var o=t.length,s=Z(t,o),a=0;a<o;++a)s[a].call(r,n,i)}(e,u,this,arguments[1],arguments[2]);break;case 4:!function(t,e,r,n,i,o){if(e)t.call(r,n,i,o);else for(var s=t.length,a=Z(t,s),u=0;u<s;++u)a[u].call(r,n,i,o)}(e,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=Array(a-1),n=1;n<a;n++)r[n-1]=arguments[n];!function(t,e,r,n){if(e)t.apply(r,n);else for(var i=t.length,o=Z(t,i),s=0;s<i;++s)o[s].apply(r,n)}(e,u,this,r)}return!0},K.prototype.addListener=function(t,e){return H(this,t,e,!1)},K.prototype.on=K.prototype.addListener,K.prototype.prependListener=function(t,e){return H(this,t,e,!0)},K.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,q(this,t,e)),this},K.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,q(this,t,e)),this},K.prototype.removeListener=function(t,e){var r,n,i,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[t]))return this;if(r===e||r.listener&&r.listener===e)0==--this._eventsCount?this._events=new J:(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,o=r.length;0<o--;)if(r[o]===e||r[o].listener&&r[o].listener===e){s=r[o].listener,i=o;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new J,this;delete n[t]}else!function(t,e){for(var r=e,n=r+1,i=t.length;n<i;r+=1,n+=1)t[r]=t[n];t.pop()}(r,i);n.removeListener&&this.emit("removeListener",t,s||e)}return this},K.prototype.removeAllListeners=function(t){var e,r=this._events;if(!r)return this;if(!r.removeListener)return 0===arguments.length?(this._events=new J,this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=new J:delete r[t]),this;if(0===arguments.length){for(var n,i=Object.keys(r),o=0;o<i.length;++o)"removeListener"!==(n=i[o])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new J,this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)for(;this.removeListener(t,e[e.length-1]),e[0];);return this},K.prototype.listeners=function(t){var e=this._events,r=e&&(r=e[t])?"function"==typeof r?[r.listener||r]:function(t){for(var e=Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(r):[];return r},K.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):X.call(t,e)},K.prototype.listenerCount=X,K.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};var G=new Uint8Array(16);var Q=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var tt=[],et=0;et<256;++et)tt.push((et+256).toString(16).substr(1));function rt(t,e){e=1<arguments.length&&void 0!==e?e:0,t=(tt[t[e+0]]+tt[t[e+1]]+tt[t[e+2]]+tt[t[e+3]]+"-"+tt[t[e+4]]+tt[t[e+5]]+"-"+tt[t[e+6]]+tt[t[e+7]]+"-"+tt[t[e+8]]+tt[t[e+9]]+"-"+tt[t[e+10]]+tt[t[e+11]]+tt[t[e+12]]+tt[t[e+13]]+tt[t[e+14]]+tt[t[e+15]]).toLowerCase();if("string"!=typeof(e=t)||!Q.test(e))throw TypeError("Stringified UUID is invalid");return t}function nt(t,e,r){var n=(t=t||{}).random||(t.rng||function(){if(!k&&!(k="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return k(G)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=n[i];return e}return rt(n)}var it={host:"https://insignia-6t9a4.ondigitalocean.app",bitclout:"https://identity.bitclout.com"};class ot{constructor(t){this.opts=t||{},this.opts.api=(null==t?void 0:t.api)||it.bitclout,this.opts.test=null==t?void 0:t.test,this.eventEmitter=new K,this.identityWindow=null,this.iframe=document.getElementById("identity"),window.addEventListener("message",async t=>this.handleMessage(t),!1),this.iframe||this.initializeIFrame()}initializeIFrame(){this.iframe=document.createElement("iframe"),this.iframe.src="https://identity.bitclout.com/embed",this.iframe.frameBorder=0,this.iframe.style.width="100vw",this.iframe.style.height="100vh",this.iframe.style.display="none",document.body.appendChild(this.iframe)}async handleMessage(e){var t;const r=this;if("identity"===e.data.service){const n=null!==(t={initialize:async()=>{e.source.postMessage({id:e.data.id,service:e.data.service},e.origin),r.iframe||(r.initializeIFrame(),await r.sendInfoSync())},login:async()=>{var t;r.identityWindow&&(r.identityWindow.close(),r.identityWindow=null,localStorage.setItem("identityUser",JSON.stringify(e.data.payload.users[e.data.payload.publicKeyAdded])),e.data.payload.publicKeyAdded?(t=e.data.payload.users[e.data.payload.publicKeyAdded],t=await r.sendJWTSync({accessLevel:t.accessLevel,accessLevelHmac:t.accessLevelHmac,encryptedSeedHex:t.encryptedSeedHex}),r.eventEmitter.emit("login",{token:t,publicKey:e.data.payload.publicKeyAdded})):r.eventEmitter.emit("logout",{}))}}[e.data.method])&&void 0!==t?t:function(){e.data.payload.jwt?r.eventEmitter.emit(e.data.id,e.data.payload.jwt):r.eventEmitter.emit(e.data.id,e.data.payload)};await n()}}sendInfoSync(){return this.send({method:"info",payload:{}})}async send(n){return new Promise((e,t)=>{var r;this.iframe?(r=nt(),this.iframe.contentWindow.postMessage({id:r,service:"identity",method:n.method,payload:n.payload},"*"),this.eventEmitter.on(r,t=>e(t))):t(Error("Not initialized yet"))})}sendJWTSync(t){return this.send({method:"jwt",payload:t})}get position(){return{x:window.outerHeight/2+window.screenY-500,y:window.outerWidth/2+window.screenX-400}}logoutAsync(n){return new Promise((e,r)=>{try{const t=[`publicKey=${n}`];this.opts.test&&t.push("testnet=true"),this.identityWindow=window.open(`${this.opts.api}/logout?${t.join("&")}`,"logout",`toolbar=no, width=800, height=1000, top=${this.position.x}, left=${this.position.y}`),this.eventEmitter.on("logout",t=>e(t))}catch(t){r(t)}})}async loginAsync(n){return new Promise((e,r)=>{try{const t=[];this.opts.test&&t.push("testnet=true"),null!=n&&t.push(`accessLevelRequest=${n}`),this.identityWindow=window.open(`${this.opts.api}/log-in${0<t.length?"?":""}${t.join("&")}`,void 0,`toolbar=no, width=800, height=1000, top=${this.position.x}, left=${this.position.y}`),this.eventEmitter.on("login",t=>e(t))}catch(t){r(t)}})}}var st=function(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]};var at=function(r){return function t(e){return 0===arguments.length||st(e)?t:r.apply(this,arguments)}};var e=function(n){return function t(e,r){switch(arguments.length){case 0:return t;case 1:return st(e)?t:at(function(t){return n(e,t)});default:return st(e)&&st(r)?t:st(e)?at(function(t){return n(t,r)}):st(r)?at(function(t){return n(e,t)}):n(e,r)}}},ut=e(function(t,e){for(var r,n={},i={},o=0,s=t.length;o<s;)o+=i[t[o]]=1;for(r in e)i.hasOwnProperty(r)||(n[r]=e[r]);return n});var ft=function(t,e){return Object.prototype.hasOwnProperty.call(e,t)};var ht="function"==typeof Object.assign?Object.assign:function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1,n=arguments.length;r<n;){var i=arguments[r];if(null!=i)for(var o in i)ft(o,i)&&(e[o]=i[o]);r+=1}return e},ct=e(function(t,e){return ht({},t,e)}),lt={};async function pt(t=it.host,e,r){var n,i="/v1/users",o=`${t}${i}`,s=JSON.stringify(Object.assign(Object.assign({},ut(["password"])(r)),{credentials:{password:r.password}})),n=e.appKey?{Signature:(r=e.appKey,n=[(n={method:"POST",path:i,body:s,host:t,appId:e.appId}).method,new u(n.host).hostname,n.path,n.appId,n.query,n.body].filter(t=>!!t).join("\n"),lt.createHmac("sha256",r).update(n).digest().toString("base64"))}:{},s={method:"POST",headers:ct({"Content-type":"application/json","App-Id":e.appId},n),body:s};const a=await fetch(o,s);s=await a.text(),s=JSON.parse(s||{});if(s.error)throw Error(s.error.message);return s}t.WebClient=class{constructor(t){this.opts=t,this.bitcloutInstance=new ot({test:this.opts.bitcloutTestnet})}get user(){const e=this;return{create:t=>pt(e.opts.host,e.opts,t)}}get token(){const r=this;return{authenticate:async t=>{let e=t;return"bitclout"===e.grantType&&(t=await this.bitcloutInstance.loginAsync(),e=Object.assign(Object.assign({},e),t)),async function(t=it.host,e,r){t=`${t}/v1/authenticate`,r=JSON.stringify(r);const n=await fetch(t,{method:"POST",headers:{"Content-type":"application/json","App-Id":e},body:r});if(r=await n.text(),(r=JSON.parse(r||{})).error)throw Error(r.error.message);return r}(r.opts.host,r.opts.appId,e)},revoke:async t=>{var e=JSON.parse(""+g.from(t.refreshToken.split(".")[1],"base64"));return await this.bitcloutInstance.logoutAsync(e.externalId),async function(t=it.host,e,r){t=`${t}/v1/revoke`,r=JSON.stringify(r);const n=await fetch(t,{method:"POST",headers:{"Content-type":"application/json","App-Id":e},body:r});if(r=await n.text(),(r=JSON.parse(r||{})).error)throw Error(r.error.message);return!0}(r.opts.host,r.opts.appId,t)}}}},Object.defineProperty(t,"__esModule",{value:!0})});
